{%- if context.location.href != "/" -%}
  {%- graphql g = "get_page_contributors", slug: context.location.href -%}
  {%- assign page_contributors = g.models.results.last -%}
  {%- assign key = context.page.slug -%}

  {% comment %}
    For every page we do not want to call Github to fetch contributores
    more often than once a day
  {% endcomment %}

  {%- cache key, expire: 86400 -%}
    {%- if page_contributors.id != blank -%}
      {%- graphql res = "fetch_page_contributors_from_github", id: page_contributors.id -%}
      {%- assign page_contributors = res.customization_update -%}
    {%- else -%}
      {%- capture "page_path" -%}app/views/pages{{ context.location.href }}.liquid{%- endcapture -%}
      {%- assign slug = context.location.href -%}
      {%- graphql res = "create_page_contributors", slug: slug, paths: page_path -%}
      {%- assign page_contributors = res.customization_create -%}
    {%- endif -%}

    {%- if page_contributors.contributors != blank -%}
      {% assign slugFromHref = context.location.href | remove_first: '/' %}
      {% assign updatedAt = context.exports.nav.pagesUpdatedAt | select: slug: slugFromHref | first | fetch: "updated_at" | date: "%b %d, %Y" %}

      <div class="contributors">
        <div class="row">
          <div class="col-sm-5">
            <span>Last edit: {{ updatedAt }}</span>
          </div>
        </div>
      </div>
    {%- endif -%}
  {%- endcache -%}
{%- endif -%}
